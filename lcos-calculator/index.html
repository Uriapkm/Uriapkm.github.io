<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LCOS Calculator (Retro Excel Style)</title>
<style>
  body {
    font-family: "Courier New", monospace;
    margin: 0;
    padding: 2rem;
    background: #eaeaea;
  }
  h1 {
    text-align: center;
    background: #004c80;
    color: #fff;
    padding: 0.5rem;
    margin-bottom: 1rem;
    border: 2px solid #003354;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    background: #fff;
    border: 2px solid #444;
    font-size: 0.9rem;
  }
  th, td {
    border: 1px solid #999;
    padding: 6px 8px;
    text-align: left;
  }
  th {
    background: #c0c0c0;
  }
  tr:nth-child(even) td {
    background: #f7f7f7;
  }
  input {
    width: 100%;
    border: none;
    background: transparent;
    font-family: inherit;
    font-size: inherit;
    text-align: right;
    padding: 2px;
  }
  input:focus {
    outline: 1px dashed #333;
    background: #ffffe0;
  }
  #result {
    margin-top: 1rem;
    padding: 0.5rem;
    border: 2px solid #333;
    background: #fdfdfd;
    font-weight: bold;
    font-size: 1.1rem;
    text-align: center;
  }
  #chart {
    margin-top: 2rem;
    border: 2px solid #333;
    background: #fff;
    padding: 0.5rem;
  }
  #formulas {
    margin-top: 2rem;
    padding: 1rem;
    background: #fff;
    border: 2px solid #444;
  }
  #formulas h2 {
    text-align: center;
    margin-top: 0;
  }
  footer {
    margin-top: 1.5rem;
    font-size: 0.8rem;
    color: #333;
    text-align: center;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const $ = id => document.getElementById(id);
const val = id => parseFloat($(id).value)||0;

let chart;

function compute(){
  const etaRTE   = val('etaRTE')/100;
  const etaDisch = val('etaDisch')/100;
  const cycles   = val('cycles');
  const life     = val('life');
  const ePrice   = val('ePrice');
  const lambda   = val('lambda')/100;
  const r        = val('r')/100;

  const SB   = val('SB');
  const BoP  = val('BoP');
  const SI   = val('SI');
  const PD   = val('PD');
  const EPC  = val('EPC');
  const CC   = val('CC');
  const PCS  = val('PCS');
  const GI   = val('GI');
  const Elec = val('Electrolyte');

  // CCNPV
  const CCNPV = (SB+BoP+SI+PD+EPC)/etaDisch + CC + PCS + GI;

  // O&M PV with n=0..life-1
  const annualOandM = lambda*(SB+BoP+PCS+CC+SI)/etaDisch;
  let OandMPV = 0;
  for (let n=0; n<life; n++) {
    OandMPV += annualOandM / Math.pow(1+r, n);
  }

  // Residual Value
  const Vresidual = 0.70 * Elec;

  // Energy Loss
  const Eloss = ePrice*(1/etaRTE - 1);

  // Denominator: discounted discharge energy n=0..life-1
  let denom = 0;
  for (let n=0; n<life; n++) {
    denom += cycles / Math.pow(1+r, n);
  }

  // LCOS
  const numerator = CCNPV + OandMPV - Vresidual/Math.pow(1+r,life);
  const LCOS = (numerator/denom) + Eloss;

  $('result').textContent = `LCOS = ${LCOS.toFixed(4)} €/kWh`;

  // Chart data
  const labels = [], omSeries = [], energySeries = [], lcosSeries=[];
  let cumEnergy=0, cumCost=CCNPV;
  for(let year=0; year<life; year++){
    const discFactor = Math.pow(1+r,year);
    const discountedOM = annualOandM/discFactor;
    cumEnergy += cycles/discFactor;
    cumCost += discountedOM;
    labels.push(year);
    omSeries.push(discountedOM);
    energySeries.push(cumEnergy);
    lcosSeries.push((cumCost - Vresidual/Math.pow(1+r,life))/cumEnergy + Eloss);
  }

  if(chart) chart.destroy();
  chart = new Chart($('chart').getContext('2d'), {
    type:'line',
    data:{
      labels,
      datasets:[
        {label:'O&M discounted €/kWh', data:omSeries, borderColor:'blue', yAxisID:'y1'},
        {label:'Cumulated Energy (kWh)', data:energySeries, borderColor:'green', yAxisID:'y2'},
        {label:'LCOS over time (€/kWh)', data:lcosSeries, borderColor:'red', yAxisID:'y1'}
      ]
    },
    options:{
      responsive:false,
      interaction:{mode:'index'},
      scales:{
        y1:{type:'linear',position:'left',title:{display:true,text:'€/kWh'}},
        y2:{type:'linear',position:'right',title:{display:true,text:'kWh'},grid:{drawOnChartArea:false}}
      }
    }
  });
}

document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll('input').forEach(el=>el.addEventListener('input',compute));
  compute();
});
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

<h1>Levelised Cost of Storage (LCOS) Calculator</h1>

<table>
  <tr><th>Parameter</th><th>Value</th></tr>
  <tr><td>Round-Trip Efficiency ηRTE (%)</td><td><input id="etaRTE" type="number" value="70"></td></tr>
  <tr><td>Discharge Efficiency ηdisch (%)</td><td><input id="etaDisch" type="number" value="71"></td></tr>
  <tr><td>Full Cycles per year</td><td><input id="cycles" type="number" value="360"></td></tr>
  <tr><td>Project Lifetime (years)</td><td><input id="life" type="number" value="25"></td></tr>
  <tr><td>Electricity Price (€/kWh)</td><td><input id="ePrice" type="number" value="0.0813"></td></tr>
  <tr><td>O&amp;M Factor λ (%)</td><td><input id="lambda" type="number" value="1"></td></tr>
  <tr><td>Discount Rate r (%)</td><td><input id="r" type="number" value="7"></td></tr>
  <tr><td>Storage Battery SB (€/kWh)</td><td><input id="SB" type="number" value="246.58"></td></tr>
  <tr><td>Balance of Plant BoP (€/kWh)</td><td><input id="BoP" type="number" value="39.46"></td></tr>
  <tr><td>System Integration SI (€/kWh)</td><td><input id="SI" type="number" value="37.21"></td></tr>
  <tr><td>Project Development PD (€/kWh)</td><td><input id="PD" type="number" value="49.78"></td></tr>
  <tr><td>EPC (€/kWh)</td><td><input id="EPC" type="number" value="47.89"></td></tr>
  <tr><td>Contingency CC (€/kWh)</td><td><input id="CC" type="number" value="0.29"></td></tr>
  <tr><td>PCS (€/kWh)</td><td><input id="PCS" type="number" value="9.61"></td></tr>
  <tr><td>Grid Integration GI (€/kWh)</td><td><input id="GI" type="number" value="5.11"></td></tr>
  <tr><td>Electrolyte (€/kWh)</td><td><input id="Electrolyte" type="number" value="188.16"></td></tr>
</table>

<div id="result">LCOS = …</div>

<canvas id="chart" width="900" height="300"></canvas>

<div id="formulas">
  <h2>Formulas</h2>

  <p><strong>Levelised Cost of Storage (LCOS)</strong></p>
  <p>
  \[
  LCOS \;=\;
  \frac{CCNPV + O\&M_{PV} - \dfrac{V_{residual}}{(1+r)^{life}}}
  {\displaystyle \sum_{n=0}^{\,life-1} \frac{cycles}{(1+r)^n}}
  \;+\; E_{loss}
  \]
  </p>

  <hr style="margin:1em 0;">

  <p><strong>Capital Cost (Net Present Value)</strong></p>
  <p>
  \[
  CCNPV \;=\;
  \frac{SB + BoP + SI + PD + EPC}{\eta_{disch}} + CC + PCS + GI
  \]
  </p>

  <p><strong>Operation &amp; Maintenance (NPV)</strong></p>
  <p>
  \[
  O\&M_{PV} \;=\;
  \sum_{n=0}^{\,life-1}
  \frac{\lambda \cdot (SB + BoP + PCS + CC + SI)}{\eta_{disch}\,(1+r)^n}
  \]
  </p>

  <p><strong>Residual Value</strong></p>
  <p>
  \[
  V_{residual} \;=\; 0.70 \times Electrolyte
  \]
  </p>

  <p><strong>Energy Loss Penalty</strong></p>
  <p>
  \[
  E_{loss} \;=\; E_{price}\,\left(\frac{1}{\eta_{RTE}} - 1\right)
  \]
  </p>
</div>

<footer>
  Retro style inspired by Excel 95<br>
  Formula source: LCOS calculation.pdf
</footer>

</body>
</html>
